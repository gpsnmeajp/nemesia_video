# nostrというSNSの仕組みを解説

## はじめに

はじめまして、本日の解説役のネメシアと申します。
今回からこのチャンネルでは、時折解説動画を上げていこうと思っております。

初回の今回は、nostrについて解説していきます。

nostrは、画面のようなマイクロブログ風の投稿ができるSNSと認識している方もいらっしゃるかもしれません。

nostrは、2019に発表された、分散型ソーシャルネットワークを実現するための通信プロトコルです。
どこかが運営しているサービスではなく、相互に遣り取りをするための取り決め(プロトコル)です。

Notes and Other Stuff Transmitted by Relaysを略して、nostrと呼びます。

リアルタイムな投稿、リポスト、引用、絵文字リアクションなどをサポートしており、
まさにTwitter風ソーシャルネットワークを実現するための機能を持っています。

一方で、公開鍵暗号技術を用いた非常に独特な性質を持ったプロトコルになっています。
その理念や、実装、様々な性質について、詳しく解説して参ります。

## 0. とりあえず
先に、以下の疑問に回答しておきます。

Q. nostrは実用的か？  
A. 使い物になるという意味では、はい。  
 従来のSNSのような行き届いたサービスや親切さか、という意味では、いいえ。

Q. nostrはおすすめか？
A. 「nostrはおすすめか？」と聞いてくるような人には、現時点でお薦めはできません。  
 技術的な面白さを感じられる人か、発展途上の秘境感を味わいたい人には向いているかもしれません。

nostrに触ったことがない人は、まず、使ってみることをおすすめします。

nostterを開き、Try demoをクリック。
https://nostter.vercel.app/

これで、日本人ユーザー(bot)の視点から眺めることができます。  
発言やフォローはできませんので、試したくなったら、設定からLogoutをクリックし、Create Accountから自分のアカウントを作成してください。

それでは、解説を始めます。

## 1. 理念

nostrは、「勝手な投稿の修正や削除を難しくし、また凍結やBANを無意味にする」という理念を、掲げています。
主に、有名ソーシャルネットワークで発生する、不本意な凍結やBANに対して考えられたものと思ってください。

これを、通常、censorship-resistant(検閲耐性)と呼びます。
今後説明するすべての概念や仕組みに絡んでくる重要な要素ですので、覚えておいてください。

一方で、注意してほしいのですが、nostr単体での匿名性は低いです。
普通に接続する限り、投稿(あるいは投稿を複製した人)のIPアドレスと公開鍵がひも付きます。


# 2. 実装

nostrの実装について語る前に、従来のソーシャルネットワークの実装を見てみましょう。

## 中央集権型

まず、中央集権型。
いわゆるTwitterなどの、従来型のWebサービスです。

サービスが用意した唯一のサーバー群に所属・接続し、そこのサービスを利用します。

サービス運営者が責任を持って、インフラ整備や環境整備を行いますので、
サービスの運営が正常なうちは、非常に快適に使用することができます。
治安維持も行われ、人物の唯一性も担保されますし、公式アプリなどが精力的に提供されます。

一方で、サービスの運営が破綻すると、広告が大量に差し込まれたり、
投稿の表示にさまざまな"アルゴリズム"が導入されたり、意図しない凍結やBAN、投稿の削除、
アカウントの没収、APIの有料化や凍結なども発生します。

またサービスが不安定になったりした場合でも、引っ越しなどを行うことは原則できません。
ソーシャルグラフは閉じ込められており、データも動かすことができないためです。

## 連合分散型

これに対抗して生まれたのが、連合分散型です。
ActivityPubプロトコルを採用しているmastodonや、日本ではMisskeyなどが有名です。

これは、個人や企業が立てたサーバー1つ1つを、小さなソーシャルネットワークとして機能させ、
そのサーバー同士を、共通のプロトコルで接続することで、巨大なソーシャルネットワークとして機能するようにしたものです。

各ユーザーは、サーバーに所属し、そこから閲覧・投稿することとなります。
@nemesia@achetaria.com のように、アカウント名の後ろに所属サーバーがついています。

従来どおり、ブラウザやアプリから簡単に使用することができます。

所属サーバー自体が小さなソーシャルネットワークとして機能するようになっていることが多いため、
サーバーごとに様々な文化があり、規約や管理者もバラバラです。個人が運営していることも多いです。

そのため、気の合う管理者や、精力的な管理者であれば、快適に使えますが、
そうでない場合は、居心地が悪かったり、使い方の想定が合わず凍結や削除される場合もあります。

サーバーそのものが所属となるため、人が一極集中しやすい問題もあります。
個人管理のサーバーは、突然管理放棄される可能性すらあります。

いずれにせよ、ほとんどのサーバーは収益のためというより、善意で運営されています。
大企業ほどのサポートや利用体験の良さは期待できないでしょう。

さらに、管理責任の都合上、サーバー管理者同士の理念思想の違いや、仲の悪さによって、
サーバー同士が接続しない(ドメインブロック)を実施している場合があります。

その場合でも、大きくは同じネットワークに居ますので、別のサーバーに引っ越すという
選択が取れるのが連合分散型の利点です。
ただし、サーバー独自機能を利用していた場合は、引っ越すと使えなくなる事が多いです。

こういったバラバラ具合は、利点とも欠点とも言えます

技術的には、ActivityPubのinbox-outboxモデルの負荷が大きいという問題もあるようです。

## リレー分散型

nostrは、「リレー分散型」になります。

ここまで語ってきた問題や欠点は、どれも「サーバーに所属する」という点にあります。
そこで、特定のサーバーに所属しないという戦略をもとに作られたのが、nostrプロトコルです。

しかし、全員がお一人サーバーを立てる、あるいは、P2Pのような仕組みでは、現実的に普及しません。

そこでnostrでは、サーバーの役目や責任を極力削ぐことで実現します。
具体的には、サーバーを比較的単純な「リレー」として、所属機能などを排除しています。

所属がないので、個人を証明してくれる存在はなく、IDもパスワードもありません。

それではどうやって、投稿者を区別し、なりすましを防止するかということになりますが、
nostrでは公開鍵がユーザーということになります。

公開鍵署名技術により、各サーバーやクライアントは、投稿データと、投稿データの署名と、公開鍵を合わせて計算することで、ある投稿が、公開鍵の正当な持ち主が作り出したものであるかを暗号学的に検証することができます。

その署名を行うために必要なのは、公開鍵のもととなる秘密鍵です。
すなわち、nostrでは、公開鍵がID、秘密鍵がパスワードです。

これらは、対でのみ存在できるものですので、公開鍵(ID)を
そのままに秘密鍵(パスワード)だけを変更することはできません。

即ち、無くしたり漏らしたりした時点で、nostrの世界では使い物にならなくなります。
秘密鍵は、自分のクライアント以外の誰にも渡す必要がなく、渡してはいけません。

さて、これで所属へのサーバーに頼らず、自己の証明ができることになりました。
この公開鍵署名の性質により、誰にもBANや凍結をされることもありませんし、偽の投稿をされることもありません。

サーバーによって書き換えられても、受け取り手で書き換えられているかどうかの検証もできます。

そのため、リレーの役目は、Websoketで実装されたプロトコルに従い、
投稿を受け付け再配信することと、過去の投稿を要求に合わせて再配信することだけです。

それ以外の役目、Webフロントエンドの提供や、ログイン機能の提供、サーバー間での投稿の中継などは要求されません。

実装しても良いし、実装することはできますが、本質ではありません。

閲覧や投稿のための機能はすべて、クライアントが実装すべきものであるためです。

リレーは、先程述べたように公開鍵署名の性質により、投稿を書き換えることはできません。
ただ、中継しないということはできます。
そもそもサーバーに接続させないとか、接続のためにメールアドレスを要求したり、課金を要求することもできます。

それでは、BANや凍結とほぼ同じじゃないかと思うかもしれません。
実際、スパムや危険な投稿はリレーが遮断します。

では、どうするのかというと、各ユーザーは複数のリレーに接続します。
好きな数だけ接続して構いません。3つでも、20でも、帯域の許す限り、
好きなだけリレーに接続することができます。

これにより、経路の冗長化と、到達性の拡大ができます。

リレーが落ちようが、BANされようが、残りのリレーを経由して到達します。
ただし、共通のリレーが無くなった相手は見えなくなります。

これが、nostrの仕組みです。

# 3.利点と欠点

nostrはこのような、非常に割り切りの強い構造をしています。
そのため、他にはない性質を多数持っています。

## 利点

### 原理的にBANや凍結がない

すでに述べた通り、どこにも所属せずに、公開鍵と署名のみで自己を表すため、
凍結やBANといったものが存在しません。

リレーから追放されることはありますが、リレーを乗り換えていくことで回避可能です。
繋がりたい相手には、新しいリレーを教えることで再度つながることができます。

### 冗長性が高い

### リアルタイム性が高い

### リレーの責任が軽い

### 単なる投稿以外の様々な使い道が次々開発されている

## 欠点

### 予想以上のところに飛んでいくことがある

### 削除が効かない

### データの保持が本質的に不安定

### スパムや宣伝の温床

### 必要な相手に到達するハードルが少々高い(リレー問題)

### 挙動が不安定

### 秘密鍵の管理

## クライアントの種類

### Damus

### Amethyst

### Rabbit

### nostter

### 
